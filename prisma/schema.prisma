datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           Int     @id @default(autoincrement())
  fullname     String
  username     String  @unique
  referralCode String
  mobile       String
  email        String?
  password     String
  txnPassword  String

  referredBy Int?
  parent     User?  @relation("UserParent", fields: [referredBy], references: [id])
  children   User[] @relation("UserParent")

  isActive    Boolean @default(false)
  isBlocked   Boolean @default(false)
  isSuspended Boolean @default(false)

  createdAt DateTime @default(now())

  deposits       Deposit[]
  withdraws      Withdraw[]
  wallet         Wallet?
  depositHistory DepositHistory[]

  // ⭐ NEW RELATIONS
  approvedDeposits ApprovedDeposit[]   @relation("ApprovedDepositToUser")
  rejectedDeposits RejectedDeposit[]   @relation("RejectedDepositToUser")
}



model Wallet {
  id     Int  @id @default(autoincrement())
  userId Int  @unique
  user   User @relation(fields: [userId], references: [id])

  mainWallet     Float @default(0)
  roiWallet      Float @default(0)
  referralWallet Float @default(0)
  levelWallet    Float @default(0)
  returnWallet   Float @default(0)
  salaryWallet   Float @default(0)
  donationWallet Float @default(0)
}

model Deposit {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  amount    Float
  trxId     String
  status    String   @default("pending")
  createdAt DateTime @default(now())

  /// ⭐ নতুন relation
  history DepositHistory[]
}

model Withdraw {
  id     Int  @id @default(autoincrement())
  userId Int
  user   User @relation(fields: [userId], references: [id])

  amount     Float
  walletType String
  status     String   @default("pending")
  createdAt  DateTime @default(now())
}

model Admin {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())

  processed DepositHistory[] @relation("AdminProcessRelation")
}

model ApprovedDeposit {
  id        Int      @id @default(autoincrement())
  userId    Int
  amount    Float
  trxId     String
  createdAt DateTime @default(now())

  user   User @relation("ApprovedDepositToUser", fields: [userId], references: [id])
}



model RejectedDeposit {
  id        Int      @id @default(autoincrement())
  userId    Int
  amount    Float
  trxId     String
  createdAt DateTime @default(now())

  user   User @relation("RejectedDepositToUser", fields: [userId], references: [id])
}



model DepositHistory {
  id          Int      @id @default(autoincrement())
  userId      Int
  depositId   Int
  amount      Float
  trxId       String
  status      String
  processedBy Int
  createdAt   DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id])
  deposit Deposit @relation(fields: [depositId], references: [id])
  admin   Admin   @relation("AdminProcessRelation", fields: [processedBy], references: [id])
}
